<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Understanding the generative nature of LDA with R - Till Bergmann</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./lda-generation-R.html">

        <meta name="author" content="Till Bergmann" />
        <meta name="keywords" content="LDA,generative model,R" />
        <meta name="description" content="Topic modeling is a suite of algorithms that discover latent topics in large corpora of texts. To better understand what topic modeling does, I&#39;ll explain the conceptual background behind the algorithm(s). Topic modeling finds topics in a document that summarize the document in a &#34;compressed&#34; manner - as a weighted …" />

        <meta property="og:site_name" content="Till Bergmann" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Understanding the generative nature of LDA with R"/>
        <meta property="og:url" content="./lda-generation-R.html"/>
        <meta property="og:description" content="Topic modeling is a suite of algorithms that discover latent topics in large corpora of texts. To better understand what topic modeling does, I&#39;ll explain the conceptual background behind the algorithm(s). Topic modeling finds topics in a document that summarize the document in a &#34;compressed&#34; manner - as a weighted …"/>
        <meta property="article:published_time" content="2015-12-11" />
            <meta property="article:section" content="misc" />
            <meta property="article:tag" content="LDA" />
            <meta property="article:tag" content="generative model" />
            <meta property="article:tag" content="R" />
            <meta property="article:author" content="Till Bergmann" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.readable.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/solarizedlight.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link href="./static/custom.css" rel="stylesheet">



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
Till Bergmann            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/about.html">
                             About
                          </a></li>
                         <li><a href="./pages/publications.html">
                             Publications
                          </a></li>
                         <li><a href="./pages/resources.html">
                             Resources
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./lda-generation-R.html"
                       rel="bookmark"
                       title="Permalink to Understanding the generative nature of LDA with R">
                        Understanding the generative nature of LDA with R
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-12-11T00:00:00+01:00"> Fri 11 December 2015</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="./tag/lda.html">LDA</a>
        /
	<a href="./tag/generative-model.html">generative model</a>
        /
	<a href="./tag/r.html">R</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Topic modeling is a suite of algorithms that discover latent topics in large corpora of texts. To better understand what topic modeling does, I'll explain the conceptual background behind the algorithm(s). Topic modeling finds topics in a document that summarize the document in a "compressed" manner - as a weighted combination of topics. Simply put, it finds the the semantic <em>gist</em> of a document. For example, imagine a newspaper: Traditionally, the articles within one issue cover different topics, such as sports, economics and foreign relations. In a newspaper, these topics are usually given to us, by sections and heading. If the headings are not there, we can manually examine the articles to find out to which category they belong. Even if you have little knowledge of specific sports, you will still be able to recognize an article about the NFL as such. But now imagine that instead of one newspaper issue, you have millions - it is impossible to discover all topics by hand. This is where topic modeling comes in! It can automatically discover these topics for you, without the need to manually examine each and every article. But how does it do it?</p>
<p>In this blog post, I will focus on the most basic form of topic modeling, called <em>Latent Dirichlet Allocation</em> (LDA), first proposed by <a name=cite-Blei_2003></a><a href="#bib-Blei_2003">Blei, Ng, and Jordan (2003)</a> (for an accessible review, see <a name=cite-Blei_2012></a>(<a href="http://dx.doi.org/10.1145/2133806.2133826">Blei, 2012</a>)). Multiple algorithms have been built on top of LDA now, extending it to various other uses. In LDA, each document is given a distribution over topics, such that some topics are more likely to be contained in a given document than others. Each document thus belongs to more than one topic, but to a different degree. In turn, each topic is represented by a distribution over terms (words), following the same principle. A document is composed of topics, and each topic is composed of terms. </p>
<p>To better understand this, let me explain how LDA thinks documents are generated. To generate a document, sample a topic distribution that represents the probability each topics appears in that document. For each word in the document, assign it a topic from that topic distribution, and then draw a term from the term distribution for that topic. Of course, in reality we do not write articles like that - but it works really well for the discovery of topics. In the next sections, I'll walk through these steps point by point and go into more detail on how these distributions are generated, including R code.</p>
<h2><strong>Topic Distributions</strong></h2>
<p>LDA uses a Dirichlet distribution to generate multinomial distributions over topics. A <a href="https://en.wikipedia.org/wiki/Dirichlet_distribution">dirichlet distribtion</a> is a distribution over distributions, that is, instead of a single value, you get back a whole distribution for each sample drawn. The Dirichlet distribution has a parameter <span class="math">\(\alpha\)</span> that influences how this distribution sample looks like. For a practical example, imagine we want to generate a newspaper article, and want to assign it some topics. We can do this easily with this Dirichlet distribution in R, using the <code>rdirichlet</code> function in the <code>MCMCpack</code> package (other packages also provide this function). We will first set the <span class="math">\(\alpha\)</span> parameter to <code>.1</code>, and then explore the effects of varying it a little later. We also have to specify how many topics we want - let's use 10 to not lose track. In application of LDA this tends to be much higher, depending on your data. The number of topics is denoted by <span class="math">\(K\)</span>. We only want one document for now, so we set <span class="math">\(N\)</span>=1. When calling <code>rdirichlet</code>, you need to specify how many draws you want (here, <span class="math">\(N\)</span>), and the <span class="math">\(\alpha\)</span> parameter for each topic. Each topic here has the same <span class="math">\(\alpha\)</span>, although that could vary. </p>
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">MCMCpack</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pander</span><span class="p">)</span> 
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>

<span class="nf">set.seed</span><span class="p">(</span><span class="m">2015</span><span class="p">)</span> <span class="c1"># for reproducibility</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="m">.1</span>
<span class="n">N</span> <span class="o">=</span> <span class="m">1</span>
<span class="n">K</span> <span class="o">=</span> <span class="m">10</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">rdirichlet</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>  <span class="o">%&gt;%</span> <span class="nf">as.numeric</span><span class="p">()</span>

<span class="n">x</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">3</span><span class="p">.</span><span class="mi">701350</span><span class="n">e</span><span class="o">-</span><span class="mi">12</span> <span class="mi">2</span><span class="p">.</span><span class="mi">868758</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span> <span class="mi">1</span><span class="p">.</span><span class="mi">328463</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span> <span class="mi">4</span><span class="p">.</span><span class="mi">964977</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span> <span class="mi">6</span><span class="p">.</span><span class="mi">993802</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
<span class="o">##</span>  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="mi">1</span><span class="p">.</span><span class="mi">497147</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span> <span class="mi">7</span><span class="p">.</span><span class="mi">943219</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span> <span class="mi">6</span><span class="p">.</span><span class="mi">473852</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span> <span class="mi">1</span><span class="p">.</span><span class="mi">279675</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span> <span class="mi">8</span><span class="p">.</span><span class="mi">875518</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Probability&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="figure/lda-generation-R/unnamed-chunk-2-1.png"></p>
<p>By visualizing the distribution, we can see that six values (topics) are close to zero - the document does not contain these. One topic, number 8, is however represented to a high degree. This is the main topic of the document, while others are represented to a smaller degree. </p>
<p>The <span class="math">\(\alpha\)</span> parameters influences the shape of this distribution, more specifically, how many topics will have a (relatively) high value. In this example, it is fairly low, meaning that one topic has the majority of the probability. If we set the parameter, the distribution will be more even. We can illustrate this easily:</p>
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">1000</span><span class="p">)</span> <span class="c1"># alphas to be tested</span>
<span class="c1"># get distribution for each apha</span>
<span class="n">ds</span> <span class="o">=</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="nf">rdirichlet</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">K</span><span class="p">)))</span> 
<span class="c1"># create a data frame for plotting</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ds</span> <span class="o">%&gt;%</span> <span class="nf">unlist</span><span class="p">()</span> <span class="o">%&gt;%</span> 
            <span class="nf">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> 
            <span class="nf">mutate</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">each</span><span class="o">=</span><span class="n">K</span><span class="p">))</span> 
<span class="n">df</span><span class="o">$</span><span class="n">topic</span> <span class="o">=</span>  <span class="nf">as.factor</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">),</span> <span class="nf">length</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span>
<span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span> <span class="o">=</span> <span class="s">&quot;value&quot;</span>
<span class="n">df</span><span class="o">$</span><span class="n">alpha</span> <span class="o">=</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">alpha</span><span class="p">)</span>

<span class="c1"># plot the distributions, by alpha value</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">topic</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="figure/lda-generation-R/unnamed-chunk-3-1.png"></p>
<p>We can see that the higher the <span class="math">\(\alpha\)</span> parameter, the more even the standard distribution. A value of 1000 would make very little sense for LDA - each topic is represented equally, resulting in an incoherent document. Rather, the value of <span class="math">\(\alpha\)</span> is often fixed at either <span class="math">\(0.1\)</span> or <span class="math">\(1/K\)</span> to create distributions were some topics are highly probable. Some implementations also allow you to vary the parameter individually for each topic, although this is not as common.</p>
<p>We know now how can can generate a topic distribution for a document. We will follow a similar procedure for the word distributions. Remember, each of the ten topics has a term distribution associated with it. As this distribution is also sampled from a Dirichlet, the procedure will be very similar.</p>
<h2><strong>Term Distributions</strong></h2>
<p>Again, we have a parameter to be used with the Dirichlet distribution, this time we'll call it <span class="math">\(\beta\)</span>. This parameter will work in the same way as <span class="math">\(\alpha\)</span> did for the topic distribution. Let's first create a sample corpus of terms we can use to create the distribution over. I used the <code>rcorpora</code> package, which comes with a list of words for different domains, such as birds, proverbs and political parties. We'll use Shakespeare words here.</p>
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rcorpora</span><span class="p">)</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="nf">corpora</span><span class="p">(</span><span class="s">&quot;words/literature/shakespeare_words&quot;</span><span class="p">)</span><span class="o">$</span><span class="n">words</span>
<span class="nf">head</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="c1"># some example words</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ss">&quot;abstemious&quot;</span>    <span class="ss">&quot;academe&quot;</span>       <span class="ss">&quot;accommodation&quot;</span> <span class="ss">&quot;accused&quot;</span>      
<span class="o">##</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ss">&quot;addiction&quot;</span>     <span class="ss">&quot;admirable&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nf">length</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="c1"># length of the vocabulary</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">320</span>
</pre></div>


<p>Now let's create a distribution over these words, as not all words are equally likely to pop up in each topic. Of course, this is just a toy example - our real vocabulary is not just restricted to these 320 words Shakespeare used. In LDA, this term distribution is typically denoted by <span class="math">\(\phi\)</span>.</p>
<div class="highlight"><pre><span></span><span class="n">sizeVocab</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="m">.1</span>
<span class="n">phi</span> <span class="o">=</span> <span class="nf">rdirichlet</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">sizeVocab</span><span class="p">))</span>
<span class="c1"># Plotting distribution for the first topic</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">phi[1</span><span class="p">,</span><span class="n">]</span> <span class="o">%&gt;%</span> <span class="nf">as.numeric</span><span class="p">())</span>
</pre></div>


<p><img alt="" src="figure/lda-generation-R/unnamed-chunk-5-1.png"></p>
<div class="highlight"><pre><span></span><span class="nf">dim</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="mi">10</span> <span class="mi">320</span>
</pre></div>


<p>The plot shows the term distribution for the first topic: Again, we can see that some terms have a high probability of occurring, while the majority hover at the low values. </p>
<p>The dimensionality of <code>phi</code> show that for each of the 10 topics, we get one value for each of the 320 words. That means that each word has some probability of occurring in each topics, although often this probability is approximating zero.</p>
<h2><strong>Generating documents</strong></h2>
<p>Now that we know how these two distributions are used, we can generate documents from scratch. Of course, since our vocabulary is just a list of words, we will get incoherent documents back that are not particular insightful. But remember, this is just a toy model. When you use real data, the topics should be coherent.</p>
<p>Let's first set some additional parameters we need to generate these documents. First, we have to set the number of documents we want to generate. Let's choose <span class="math">\(N=5\)</span>. We also have to decide how long, that is, how many terms should be in each document. Let's set <span class="math">\(NumWords=20\)</span>. This is rather low number, but this way we can still analyze the documents by hand. Let's keep <span class="math">\(K=10\)</span>, and the parameters <span class="math">\(\alpha=50/K=5\)</span> and <span class="math">\(\beta=.1\)</span>. We will use the vocabulary from Shakespeare from the above example.</p>
<div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="m">5</span>
<span class="n">NumWords</span> <span class="o">=</span> <span class="m">20</span>

<span class="n">K</span> <span class="o">=</span> <span class="m">10</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="m">1</span><span class="o">/</span><span class="n">K</span>
<span class="n">beta</span> <span class="o">=</span> <span class="m">.1</span>

<span class="n">sizeVocab</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
</pre></div>


<p>Once we've set all the parameters, let's create the two distributions, for topics <span class="math">\(\theta\)</span> and terms <span class="math">\(\phi\)</span> respectively.</p>
<div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="nf">rdirichlet</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="mi">5</span> <span class="mi">10</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">phi</span> <span class="o">=</span> <span class="nf">rdirichlet</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="nf">rep</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">sizeVocab</span><span class="p">))</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="mi">10</span> <span class="mi">320</span>
</pre></div>


<p>Now remember, to generate a document, we first have to allocate topics to each word in each document. Then we have to sample a terms from that document, and concatenate those words to create the document. Let's do this step by step.</p>
<div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="m">1</span>
<span class="n">topics</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">,</span>
          <span class="n">size</span> <span class="o">=</span> <span class="n">NumWords</span><span class="p">,</span> 
          <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
          <span class="n">prob</span> <span class="o">=</span> <span class="n">theta[i</span><span class="p">,</span><span class="n">]</span><span class="p">)</span> 
<span class="n">topics</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span>
</pre></div>


<p>Our first document (<span class="math">\(i=1\)</span>) consists mainly of terms allocated to either topic number 5 or 7. By inspecting the <span class="math">\(theta\)</span> distribution for that row, we can see that this reflects the distribution:</p>
<div class="highlight"><pre><span></span><span class="n">theta[1</span><span class="p">,</span><span class="n">]</span> <span class="o">%&gt;%</span> <span class="nf">plot</span><span class="p">()</span>
</pre></div>


<p><img alt="" src="figure/lda-generation-R/unnamed-chunk-9-1.png"></p>
<p>Now that we have a topic, let's sample a word from the term distribution <span class="math">\(\phi\)</span>. We test this only for the first topic.</p>
<div class="highlight"><pre><span></span><span class="n">j</span> <span class="o">=</span> <span class="n">topics[1]</span>  <span class="c1"># first topic</span>
<span class="n">term</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> 
              <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> 
              <span class="n">prob</span> <span class="o">=</span> <span class="n">phi[j</span><span class="p">,</span><span class="n">]</span><span class="p">)</span>
<span class="n">term</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ss">&quot;enrapt&quot;</span>
</pre></div>


<p>Alright, we got our first term! To generate the whole document, we have to repeat the steps for each term-position in the document. To generate all documents, we have to do all these steps for all terms in each document. We could achieve this by writing a for-loop, but it's easier using <code>lapply</code> together with functions. Let's first wrap the commands for topic and term generation in functions.</p>
<div class="highlight"><pre><span></span><span class="c1"># takes a document i and generates a topic distribution</span>
<span class="n">generateTopics</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">i</span><span class="p">){</span>
  <span class="n">topics</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">K</span><span class="p">,</span>
          <span class="n">size</span> <span class="o">=</span> <span class="n">NumWords</span><span class="p">,</span> 
          <span class="n">replace</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
          <span class="n">prob</span> <span class="o">=</span> <span class="n">theta[i</span><span class="p">,</span><span class="n">]</span><span class="p">)</span> 
  <span class="n">topics</span>
<span class="p">}</span>

<span class="c1"># takes a topic j and samples a term from its term distribution</span>
<span class="n">generateWord</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">j</span><span class="p">){</span>
  <span class="n">term</span> <span class="o">=</span> <span class="nf">sample</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> 
                <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> 
                <span class="n">prob</span> <span class="o">=</span> <span class="n">phi[j</span><span class="p">,</span><span class="n">]</span><span class="p">)</span>
  <span class="n">term</span>
<span class="p">}</span>

<span class="nf">generateTopics</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span>  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span> <span class="mi">5</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nf">generateWord</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">##</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ss">&quot;spectacled&quot;</span>
</pre></div>


<p>Because we have to iterate over the topics generated by <code>generateTopics</code>, we'll write another function that will call <code>generateWord</code> on each topic. We can also implement a small command that will string together all the terms to make the output look a little nicer.</p>
<div class="highlight"><pre><span></span><span class="n">generateDocument</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">d</span><span class="p">){</span>
  <span class="n">topics</span> <span class="o">=</span> <span class="nf">generateTopics</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="c1"># d is the current document</span>
  <span class="n">terms</span> <span class="o">=</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="n">generateWord</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">unlist</span><span class="p">()</span> <span class="c1"># for each topic, generate a word</span>
  <span class="n">document</span> <span class="o">=</span> <span class="n">terms</span> <span class="o">%&gt;%</span> <span class="nf">paste</span><span class="p">(</span><span class="n">.,</span> <span class="n">collapse</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">)</span> <span class="c1"># string those together</span>
  <span class="n">document</span>
<span class="p">}</span>
<span class="n">documents</span> <span class="o">=</span> <span class="nf">lapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">,</span> <span class="n">generateDocument</span><span class="p">)</span>
<span class="n">documents</span>  <span class="o">%&gt;%</span> <span class="nf">pander</span><span class="p">()</span>
</pre></div>


<ul>
<li>housekeeping housekeeping new-fangled far-off gust to enmesh nimble-footed hob-nails belongings lonely  far-off revolting far-off shooting star housekeeping perusal housekeeping money's worth bold-faced urging</li>
<li>long-legged to besmirch to drug hunchbacked rumination to drug dishearten gnarled bottled excitement  hoodwinked schoolboy tranquil schoolboy to dwindle schoolboy tardily mountaineer title page to lapse</li>
<li>shooting star critical eyeball foppish posture gnarled foppish reprieve freezing to submerge enrapt apostrophe apostrophe day's work inauspicious savagery revolting long-legged to gossip to uncurl</li>
<li>revolting fitful bump consanguineous to drug tardiness luggage to torture  critic varied to submerge consanguineous critical unappeased to undress new-fallen perplex hobnob flawed deafening</li>
<li>to negotiate stillborn engagement excitement  to uncurl savage malignancy to swagger juiced courtship juiced overgrowth bandit money's worth posture to negotiate to humor malignancy shudder to forward</li>
</ul>
<!-- end of list -->

<p>The documents were successfully generated based on the term and topic distribution. Of course, they're all nonsense. Neither our vocabulary or the bag-of-words assumption, where order doesn't matter, reflect reality. Nevertheless, this procedure is the underlying idea behind the success of LDA.</p>
<h2><strong>Inference</strong></h2>
<p>Alright, we generated some documents. But how does that help us in analyzing a corpus of text? In such a case, it's the reverse situation: We have our documents, but have no idea what the topic distribution <span class="math">\(\theta\)</span> and the term distribution <span class="math">\(\phi\)</span> is. This is where the real magic comes in. LDA can leverage this generative idea to infer the two distributions. Several implementations exist to do so, including variational inference and <a href="https://en.wikipedia.org/wiki/Gibbs_sampling">Gibbs sampling</a>. Once the topic distributions and terms are inferred, it is possible to compare documents and topics to each other, as well as track changes over time. I might post another article in the near future on how this inference works in more detail - if you're interested, read the original Blei et al. paper, or this paper using Gibbs sampling <a name=cite-Griffiths_2004></a>(<a href="http://dx.doi.org/10.1073/pnas.0307752101">Griffiths and Steyvers, 2004</a>).</p>
<h2><strong>Summary</strong></h2>
<p>The blog post focused on the generative nature of LDA. LDA uses several steps to generate documents:</p>
<ol>
<li>For each topic <span class="math">\(z\)</span> (where <span class="math">\(z\)</span> is from <span class="math">\(1\)</span> to <span class="math">\(K\)</span>) generate a multinomial term distribution <span class="math">\(\phi_z\)</span> from a Dirichlet prior <span class="math">\(\beta\)</span> to represent which terms are probable in which topics. </li>
<li>For each document <span class="math">\(d\)</span>, draw a multinomial topic distribution <span class="math">\(\theta_d\)</span> from a Dirichlet prior <span class="math">\(\alpha\)</span> to represent which topics are probable in this document.</li>
<li>For each word <span class="math">\(w_{di}\)</span> in document <span class="math">\(d\)</span>:<ul>
<li>Draw a topic <span class="math">\(z_{di}\)</span> from <span class="math">\(\theta_d\)</span></li>
<li>Draw a word <span class="math">\(w_{di}\)</span> from <span class="math">\(\phi_{z_{di}}\)</span></li>
</ul>
</li>
</ol>
<p>I hope the examples (although silly) helped explain the generative process underlying LDA, as well as the conceptual reasoning behind it. While the generative process does not actually work well to generate documents, the assumptions produce great results by inferring the posterior distributions <span class="math">\(\theta\)</span> and <span class="math">\(\phi\)</span>. It has been used in a wide range of applications such as in the digital humanities, for instance, in analyzing classical scholarship <a name=cite-Mimno_2012></a>(<a href="http://dx.doi.org/10.1145/2160165.2160168">Mimno, 2012</a>), and scientometrics, for instance, tracing the history of topics in computer science <a name=cite-Hall_2008></a>(<a href="http://dx.doi.org/10.3115/1613715.1613763">Hall, Jurafsky, and Manning, 2008</a>). If you are interested in applying LDA to one of your own data sets, check out the <a href="https://cran.r-project.org/web/packages/topicmodels/index.html">topicmodels package</a> in R <a name=cite-Gr_n_2011></a>(<a href="http://dx.doi.org/10.18637/jss.v040.i13">Grün and Hornik, 2011</a>). It's fairly straightforward to use, so check out the paper and the vignettes! If you can wait, I'm planning on writing another blog post on running LDA and some ways to analyze the results shortly.</p>
<h2><strong>References</strong></h2>
<p><a name=bib-Blei_2012></a><a href="#cite-Blei_2012">[1]</a> D. M. Blei.
"Probabilistic topic models". In: <em>Communications of the ACM</em> 55.4
(Apr. 2012), p. 77. DOI:
<a href="http://dx.doi.org/10.1145/2133806.2133826">10.1145/2133806.2133826</a>.
URL:
<a href="http://dx.doi.org/10.1145/2133806.2133826">http://dx.doi.org/10.1145/2133806.2133826</a>.</p>
<p><a name=bib-Blei_2003></a><a href="#cite-Blei_2003">[2]</a> D. Blei, A. Ng
and M. Jordan. "Latent Dirichlet Allocation". In: <em>Journal of
Machine Learning Research</em> (2003).</p>
<p><a name=bib-Griffiths_2004></a><a href="#cite-Griffiths_2004">[3]</a> T. L.
Griffiths and M. Steyvers. "Finding scientific topics". In:
<em>Proceedings of the National Academy of Sciences</em> 101.Supplement 1
(Feb. 2004), pp. 5228-5235. DOI:
<a href="http://dx.doi.org/10.1073/pnas.0307752101">10.1073/pnas.0307752101</a>.
URL:
<a href="http://dx.doi.org/10.1073/pnas.0307752101">http://dx.doi.org/10.1073/pnas.0307752101</a>.</p>
<p><a name=bib-Gr_n_2011></a><a href="#cite-Gr_n_2011">[4]</a> B. Grün and K.
Hornik. " topicmodels : An R Package for Fitting Topic Models ".
In: <em>Journal of Statistical Software</em> 40.13 (2011). DOI:
<a href="http://dx.doi.org/10.18637/jss.v040.i13">10.18637/jss.v040.i13</a>.
URL:
<a href="http://dx.doi.org/10.18637/jss.v040.i13">http://dx.doi.org/10.18637/jss.v040.i13</a>.</p>
<p><a name=bib-Hall_2008></a><a href="#cite-Hall_2008">[5]</a> D. Hall, D.
Jurafsky and C. D. Manning. "Studying the history of ideas using
topic models". In: <em>Proceedings of the Conference on Empirical
Methods in Natural Language Processing - EMNLP
\textquotesingle08</em>. Association for Computational Linguistics
(ACL), 2008. DOI:
<a href="http://dx.doi.org/10.3115/1613715.1613763">10.3115/1613715.1613763</a>.
URL:
<a href="http://dx.doi.org/10.3115/1613715.1613763">http://dx.doi.org/10.3115/1613715.1613763</a>.</p>
<p><a name=bib-Mimno_2012></a><a href="#cite-Mimno_2012">[6]</a> D. Mimno.
"Computational historiography". In: <em>J. Comput. Cult. Herit.</em> 5.1
(Apr. 2012), pp. 1-19. DOI:
<a href="http://dx.doi.org/10.1145/2160165.2160168">10.1145/2160165.2160168</a>.
URL:
<a href="http://dx.doi.org/10.1145/2160165.2160168">http://dx.doi.org/10.1145/2160165.2160168</a>.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="./figure/profile_pic_linkedin.jpg"/>
        </p>
    <p>
      <strong>About Till Bergmann</strong><br/>
        I'm a data scientist and recovering academic, currently working at Salesforce Einstein. Previously, I studied  <a href='http://cogsci.ucmerced.edu/'>Cognitive & Information Sciences at UC Merced</a> and obtained a PhD in Summer 2016, before joining <a href='http://insightdatascience.com/'>Insight Data Science</a> as a fellow. 
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="http://twitter.com/till_be"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
    <li class="list-group-item"><a href="http://www.linkedin.com/in/tillbergmann"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
    <li class="list-group-item"><a href="http://github.com/tillbe"><i class="fa fa-github-square fa-lg"></i> github</a></li>
    <li class="list-group-item"><a href="mailto:till.bergmann@gmail.com"><i class="fa fa-envelope fa-lg"></i> e-mail</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Till Bergmann
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>




</body>
</html>