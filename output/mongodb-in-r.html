<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Accessing MongoDB from R with mongolite</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/publications.html">Publications</a></li>
                    <li><a href="/pages/insight-project.html">Insight Project</a></li>
                    <li><a href="/pages/resources.html">Resources</a></li>
                    <li class="active"><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/mongodb-in-r.html" rel="bookmark"
           title="Permalink to Accessing MongoDB from R with mongolite">Accessing MongoDB from R with mongolite</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-05-18T00:00:00+00:00">
                Published: Mon 18 May 2015
        </abbr>

<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/mongodb.html">mongodb</a> <a href="/tag/r.html">R</a> </p>
</footer><!-- /.post-info -->      <p>Recently, I have moved away from text files as data storage, and started using <a href="https://www.mongodb.org/">MongoDB</a>. While there are already two R packages (<code>RMongo</code> and <code>rmongodb</code>) interfacing with MongoDB, I was never completed satified with them - especially in comparison to the excellent <a href="http://api.mongodb.org/python/current/">PyMongo</a>. A couple of days ago, a new package, <code>mongolite</code>, was released and seems very promising.</p>
<p>Here, I quickly want to showcase some of the functions of mongolite, using <a href="http://en.wikipedia.org/wiki/Iris_flower_data_set">Fisher's Iris data set</a>. </p>
<div class="highlight"><pre><span></span>data<span class="p">(</span>iris<span class="p">)</span>
<span class="c1"># remove . to avoid problems with MongoDBs naming structure</span>
<span class="kp">names</span><span class="p">(</span>iris<span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span> <span class="o">=</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot;[.]&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="kp">names</span><span class="p">(</span>iris<span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span> <span class="p">)</span> 
<span class="kp">head</span><span class="p">(</span>iris<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>##   SepalLength SepalWidth PetalLength PetalWidth Species
## 1         5.1        3.5         1.4        0.2  setosa
## 2         4.9        3.0         1.4        0.2  setosa
## 3         4.7        3.2         1.3        0.2  setosa
## 4         4.6        3.1         1.5        0.2  setosa
## 5         5.0        3.6         1.4        0.2  setosa
## 6         5.4        3.9         1.7        0.4  setosa
</pre></div>


<p>First, we need to insert the data from R into a new collection in MongoDB. This is done by first establishing a connection to the collection in the database, and then calling the <code>insert</code> function on the connection handler. </p>
<div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>mongolite<span class="p">)</span>
<span class="kt">c</span> <span class="o">=</span> mongo<span class="p">(</span>collection <span class="o">=</span> <span class="s">&quot;iris&quot;</span><span class="p">,</span> db <span class="o">=</span> <span class="s">&quot;tutorials&quot;</span><span class="p">)</span>
<span class="kt">c</span><span class="o">$</span>insert<span class="p">(</span>iris<span class="p">)</span>
<span class="c1">## </span>
Complete<span class="o">!</span> Processed total of <span class="m">150</span> rows.
<span class="c1">## [1] TRUE</span>
</pre></div>


<p>We get some nice feedback from the function, showing us that we inserted 150 rows (which is the total number of rows in the Iris data set). Let's start exploring the data with <code>mongolite</code>. You can easily get the total number of rows, as well as the unique values within the <code>Species</code> column/field: </p>
<div class="highlight"><pre><span></span><span class="kt">c</span><span class="o">$</span>count<span class="p">()</span>
<span class="c1">## [1] 150</span>
<span class="kt">c</span><span class="o">$</span>distinct<span class="p">(</span><span class="s">&quot;Species&quot;</span><span class="p">)</span>
<span class="c1">## [1] &quot;setosa&quot;     &quot;versicolor&quot; &quot;virginica&quot;</span>
</pre></div>


<p>It's also possible to utilize MongoDB's aggregate function through <code>$aggregate</code>:</p>
<div class="highlight"><pre><span></span><span class="kt">c</span><span class="o">$</span>aggregate<span class="p">(</span><span class="s">&#39;[{&quot;$group&quot;: {</span>
<span class="s">                &quot;_id&quot;:&quot;$Species&quot;, </span>
<span class="s">                &quot;count&quot;: {&quot;$sum&quot;:1}, </span>
<span class="s">                &quot;avgPetalLength&quot;:{&quot;$avg&quot;:&quot;$PetalLength&quot;}</span>
<span class="s">              }}]&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## 
 Found 3 records...
 Imported 3 records. Simplifying into dataframe...
</pre></div>


<div class="highlight"><pre><span></span>##          _id count avgPetalLength
## 1  virginica    50          5.552
## 2 versicolor    50          4.260
## 3     setosa    50          1.462
</pre></div>


<p>Of course, with a small data set such as the Iris data, there is no drawback in simply doing the aggregating in <code>dplyr</code>, but if you are dealing with a big data set, querying the MongoDB database directly might give you some performance benefits, as not all the data has to be loaded into memory.</p>
<div class="highlight"><pre><span></span>iris <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>Species<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>count <span class="o">=</span> n<span class="p">(),</span> avg <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>PetalLength<span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>## Source: local data frame [3 x 3]
## 
##      Species count   avg
##       (fctr) (int) (dbl)
## 1     setosa    50 1.462
## 2 versicolor    50 4.260
## 3  virginica    50 5.552
</pre></div>


<p>Similary, let's suppose we don't need all columns/fields for an analysis. For example, maybe we're only interesting in the sepal width for one particular analysis. Instead of loading all the data into memory, we can use <code>mongolite</code> to only return chosen fields:</p>
<div class="highlight"><pre><span></span>sw <span class="o">=</span> <span class="kt">c</span><span class="o">$</span>find<span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="p">,</span> <span class="s">&#39;{&quot;SepalWidth&quot;: 1, &quot;Species&quot;: 1, &quot;_id&quot;: 0}&#39;</span><span class="p">)</span>
<span class="c1">## </span>
 Found <span class="m">150</span> records...
 Imported <span class="m">150</span> records. Simplifying into dataframe...
</pre></div>


<div class="highlight"><pre><span></span>ggplot<span class="p">(</span>sw<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> Species<span class="p">,</span> y <span class="o">=</span> SepalWidth<span class="p">))</span> <span class="o">+</span> 
         geom_boxplot<span class="p">()</span>
</pre></div>


<p><img alt="" src="figure/mongolite/sepalwidth_plot-1.png"> </p>
<p>Of course, you can also update and remove entries in your database, as well as other functions. If you'd like to know more, have a look at the package on <a href="https://github.com/jeroenooms/mongolite">github</a> and <a href="http://cran.r-project.org/web/packages/mongolite/">CRAN</a>.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>